{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.js"></script>
    <link rel="icon" type="image/png" href="{% static 'image-asset/icon.png' %}">
    <title>AI Wallpaper Generator</title>
    <link rel="stylesheet" href="{% static 'css/aistyle.css' %}">
    <style>
      body {
          margin: 0;
          font-family: 'Arial', sans-serif;
      }

      header {
          background-color: #000000;
          padding: 15px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          color: white;
      }

      header img {
          margin-right: 20px;
          margin-left: 20px;
      }

      header button {
          background-color: #ff4444; 
          color: white;
          padding: 10px 15px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
      }

      header button.avatar {
          padding: 0;
          width: 20px;
          height: 20px;
          border-radius: 50%;
          overflow: hidden;
      }

      header button.avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      section.image-generator {
          background-color: #f5f5f5;
          padding: 50px 0;
      }
      .navbar-nav li.nav-item {
        list-style-type: none;
    }
    .footer {
      background-color: #2a2a2a;
      color: white;
      padding: 20px 0;
  }
  
  .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
  }

  .copyright {
    text-decoration: none;
    color: white;
    font-weight: lighter;
    margin-left: 25px; 
}
  .back-to-top {
    text-decoration: none;
    color: white;
    font-weight: lighter;
    margin-right: 25px; 
}
.navbar-nav .dropdown-menu .dropdown-item {
    color: white;
    text-decoration: none;
    /* background-color: white; */
}

  </style>
</head>
<body>
  <header>
    <a href="{% url 'index'%}"><img src="{% static 'image-asset/icon.png' %}" width="70" height="80" alt="Website Icon"></a>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img src="{% if user.userprofiledoc.avatar %}{{ user.userprofiledoc.avatar.url }}{% else %}{% static 'image-asset/dp.jpg' %}{% endif %}" width="40" height="40" style="border-radius: 50%;">
                                <span class="caret"></span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown" style="display: none;" id="userDropdown">
                                <div id="dashboardDropdown">
                                    {% if user.userprofiledoc.is_creator %}
                                        <a class="dropdown-item" href="{% url 'ai_wallpaper_generator'%}">Dashboard</a>
                                    {% endif %}
                                    {% if user.is_superuser %}
                                        <a class="dropdown-item" href="{% url 'ai_wallpaper_generator'%}">Dashboard</a>
                                    {% endif %}
                                    {% if user.userprofiledoc.is_premium %}
                                        <a class="dropdown-item" href="{% url 'ai_wallpaper_generator'%}">Dashboard</a>
                                    {% endif %}
                                    <div class="dropdown-divider"></div>
                                </div>
                                <a class="dropdown-item" href="{% url 'logout'%}">Logout</a>
                            </div>
                        </li>
                        <script>
                            document.addEventListener('DOMContentLoaded', function () {
                                var userDropdown = document.getElementById('userDropdown');
                                document.getElementById('navbarDropdown').addEventListener('click', function () {
                                    userDropdown.style.display = userDropdown.style.display === 'none' ? 'block' : 'none';
                                });
                            });
                        </script>
                    {% else %}
                        <li class="nav-item">
                            <button type="button" class="btn btn-danger" onclick="redirectToLoginPage()">Login</button>
                        </li>
                        <script>
                            function redirectToLoginPage() {
                                window.location.href = "{% url 'login' %}";
                            }
                        </script>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
    
    
</header>
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<section class="image-generator">
    <div class="content">
        <h1>AI Wallpaper</h1>
        <p>Easily create a vivid image from scratch with our AI image generator by entering descriptive text. Disclaimer.</p>
        <form id="generate-form" class="generate-form" method="post" action="{% url 'ai_wallpaper_generator' %}">
            {% csrf_token %}
            <input class="prompt-input" type="text" id="prompt" name="prompt" placeholder="Describe what you want to see" required>
            <input type="hidden" name="style_id" value="26">
            <input type="hidden" name="aspect_ratio" value="16:9">
            <button type="submit" class="generate-btn" id="generate-btn">Generate</button>
        </form>
        </div>
        </section>
        <script>
            $(document).ready(function () {
                $('#generate-form').submit(function (event) {
                    // Check if the input is empty
                    if ($('#prompt').val().trim() === '') {
                        // Prevent form submission
                        event.preventDefault();
                        // Show toast message
                        Toastify({
                            text: "Please add a description before generating.",
                            duration: 3000, // 3 seconds
                            gravity: "top", // toast position
                            position: "center", // toast position
                            close: true, // close button
                            backgroundColor: "linear-gradient(to right, #ff8a00, #da1b60)", // toast background color
                        }).showToast();
                    } else {
                        // Change the button text to "Generating"
                        $('.generate-btn').text('Generating');
                    }
                });
            });
        </script>
        
        
<section class="image-gallery">
    {% if image_data %}
        <h2>Generated Images</h2>
        <div>
            {% for img_data in image_data %}
            <img src="data:image/jpeg;base64,{{ img_data.b64_json }}" alt="Generated Image">
            <a href="data:image/jpeg;base64,{{ img_data.b64_json }}" download="generated_image{{ loop.index }}.jpeg">
                <img src="{% static 'image-asset/download.svg' %}" alt="Download Icon" class="download-icon" style="width: 80px; height: 80px;">
            </a>
        {% endfor %}
        </div>
    {% elif error_message %}
        <p class="error-message">{{ error_message }}</p>
    {% else %}
        <div class="img-card"><img src="{% static 'image-asset/img-1.jpg' %}" alt="image"></div>
        <div class="img-card"><img src="{% static 'image-asset/img-2.jpg' %}" alt="image"></div>
        <div class="img-card"><img src="{% static 'image-asset/img-3.jpg' %}" alt="image"></div>
        <div class="img-card"><img src="{% static 'image-asset/img-4.jpg' %}" alt="image"></div>
    {% endif %}

</section>

    <footer class="footer">
      <div class="container">
          <div class="footer-content">
              <div class="footer-left">
                  <p class="copyright">&copy; 2023 ARR WALLPAPERS.</p>
              </div>
              <div class="footer-right">
                  <a href="#" class="back-to-top">Back to Top</a>
              </div>
          </div>
      </div>
  </footer>
  <div class="alan-btn"></div>
  <script src="https://cdn.jsdelivr.net/npm/@alan-ai/alan-sdk-web/dist/alan.min.js"></script>
  <script type="text/javascript" src="https://studio.alan.app/web/lib/alan_lib.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
  <script>
    var alanBtnInstance = alanBtn({
        key: "990295dbd0c4bd2bf080918877d35c002e956eca572e1d8b807a3e2338fdd0dc/stage",
        onCommand: function (commandData) {
            if (commandData.command === "go:back") {
                window.location.href = "{% url 'ai_wallpaper_generator' %}";
            } else if (commandData.command === "login") {
                window.location.href = "{% url 'login' %}";
            } else if (commandData.command === "go:index") {
                window.location.href = "{% url 'index' %}";
            } else if (commandData.command === "superherowallpapers") {
                window.location.href = "/category/superhero/";
            }else if (commandData.command === "animewallpapers") {
                window.location.href = "/category/anime/";
            }else if (commandData.command === "pricing") {
                window.location.href = "{% url 'subscribe_page' %}";
			}	
        },
        rootEl: document.getElementById("alan-btn"),
    });
</script>
</body>
   
<!-- <script>
    const updateImageCard = (imgDataArray) => {
        // Hide the loader
        const loader = document.querySelector(".loader");
        loader.style.display = "none";

        imgDataArray.forEach((imgObject, index) => {
            const imgCard = imageGallery.querySelectorAll(".img-card")[index];
            const imgElement = imgCard.querySelector("img");
            const downloadBtn = imgCard.querySelector(".download-btn");
            const aiGeneratedImage = `data:image/jpeg;base64,${imgObject.b64_json}`;
            imgElement.src = aiGeneratedImage;
            imgElement.onload = () => {
                imgCard.classList.remove("loading");
                downloadBtn.setAttribute("href", aiGeneratedImage);
                downloadBtn.setAttribute("download", `${new Date().getTime()}.jpg`);
            };
        });
    }

    const handleImageGeneration = async (e) => {
        e.preventDefault();
        if (isImageGenerating) return;
        const userPrompt = e.srcElement[0].value;
        const userImgQuantity = parseInt(e.srcElement[1].value);

        // Disable the generate button, update its text, and set the flag
        generateBtn.setAttribute("disabled", true);
        generateBtn.innerText = "Generating";
        isImageGenerating = true;

        // Display the loader
        const loader = document.querySelector(".loader");
        loader.style.display = "block";

        // Display the default images
        const defaultImageCards = Array.from({ length: userImgQuantity }, (_, index) =>
            `<div class="img-card default-img">
                <img src="{% static 'image-asset/img-${index + 1}.jpg' %}" alt="default image">
            </div>`
        ).join("");

        imageGallery.innerHTML = defaultImageCards;

        try {
            // Simulate the delay for generating AI images (replace this with actual API call)
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Simulate the AI-generated images (replace this with actual API response)
            const mockImageData = Array.from({ length: userImgQuantity }, () => ({
                b64_json: "mock_base64_data" // Replace with actual base64 data
            }));

            updateImageCard(mockImageData);
        } catch (error) {
            alert(error.message);
        } finally {
            generateBtn.removeAttribute("disabled");
            generateBtn.innerText = "Generate";
            isImageGenerating = false;
        }
    }
</script> -->
</html>