{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/png" href="{% static 'image-asset/icon.png' %}">
    <title>AI Wallpaper Generator</title>
    <link rel="stylesheet" href="{% static 'css/aistyle.css' %}">
    <style>
      body {
          margin: 0;
          font-family: 'Arial', sans-serif;
      }

      header {
          background-color: #000000;
          padding: 15px;
          display: flex;
          justify-content: space-between;
          align-items: center;
          color: white;
      }

      header img {
          width: 70px;
          height: 80px;
          margin-right: 15px;
      }

      header button {
          background-color: #ff4444; 
          color: white;
          padding: 10px 15px;
          border: none;
          border-radius: 5px;
          cursor: pointer;
          font-size: 14px;
      }

      header button.avatar {
          padding: 0;
          width: 40px;
          height: 40px;
          border-radius: 50%;
          overflow: hidden;
      }

      header button.avatar img {
          width: 100%;
          height: 100%;
          object-fit: cover;
      }

      section.image-generator {
          background-color: #f5f5f5;
          padding: 50px 0;
      }
      .navbar-nav li.nav-item {
        list-style-type: none;
    }
    .footer {
      background-color: #2a2a2a;
      color: white;
      padding: 20px 0;
  }
  
  .footer-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
  }

  .copyright {
    text-decoration: none;
    color: white;
    font-weight: lighter;
    margin-left: 25px; 
}
  .back-to-top {
    text-decoration: none;
    color: white;
    font-weight: lighter;
    margin-right: 25px; 
}
header button.avatar + .dropdown-menu {
  display: none;
}

/* Display the dropdown menu on hover */
header button.avatar:hover + .dropdown-menu {
  display: block;
}

/* Hide the dropdown menu when not hovering on the avatar */
header button.avatar:hover + .dropdown-menu:hover {
  display: block;
}

/* Adjust the positioning of the dropdown menu */
header button.avatar + .dropdown-menu {
  position: absolute;
  top: 100%;
  right: 0;
  z-index: 1;
}
  </style>
</head>
<body>
  <header>
    <img src="{% static 'image-asset/icon.png' %}" width="30" height="30" alt="Website Icon">

    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ml-auto">
                    {% if user.is_authenticated %}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                <img src="{% if user.userprofiledoc.avatar %}{{ user.userprofiledoc.avatar.url }}{% else %}{% static 'image-asset/dp.jpg' %}{% endif %}" width="40" height="40" style="border-radius: 50%;">
                                <span class="caret"></span>
                            </a>
                            <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                                {% if user.userprofiledoc.is_creator %}
                                    <a class="dropdown-item" href="{% url 'userprofile'%}">Dashboard</a>
                                {% endif %}
                                {% if user.is_superuser %}
                                    <a class="dropdown-item" href="{% url 'admin_dashboard'%}">Dashboard</a>
                                {% endif %}
                                {% if user.userprofiledoc.is_premium %}
                                    <a class="dropdown-item" href="{% url 'premiumuserpage'%}">Dashboard</a>
                                {% endif %}
                                <div class="dropdown-divider"></div>
                                <a class="dropdown-item" href="{% url 'logout'%}">Logout</a>
                            </div>
                        </li>
                    {% else %}
                    <li class="nav-item">
                      <button type="button" class="btn btn-danger" onclick="redirectToLoginPage()">Login</button>
                  </li>
                  
                  <script>
                      function redirectToLoginPage() {
                          window.location.href = "{% url 'login' %}";
                      }
                  </script>
                  
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>
</header>
<section class="image-generator">
    <div class="content">
        <h1>AI Wallpaper</h1>
        <p>Easily create a vivid image from scratch with our AI image generator by entering descriptive text. Disclaimer.</p>
        <form id="generate-form" class="generate-form" method="post" action="{% url 'ai_wallpaper_generator' %}">
            {% csrf_token %}
            <input class="prompt-input" type="text" id="prompt" name="prompt" placeholder="Describe what you want to see" required>
            <input type="hidden" name="style_id" value="26">
            <input type="hidden" name="aspect_ratio" value="16:9">
            <button type="submit" class="generate-btn">Generate</button>
        </form>
    </div>
</section>

<section class="image-gallery">
    {% if image_url %}
    <section class="image-result">
        <img src="{{ image_url }}" alt="Generated Image">
        <button class="download-button" onclick="downloadImage('{{ image_url }}', 'generated_image.png')">
            Download
        </button>
    </section>
    {% endif %}

    {% if error_message %}
    <section class="error-message">
        <p>{{ error_message }}</p>
    </section>
    {% endif %}

    {% for i in "1234" %}
    <div class="img-card">
        <img src="{% static 'generated_images/generated_image_'|add:i|stringformat:"s.jpg" %}" alt="Generated Image {{ i }}">
    </div>
    {% endfor %}

    {% if not image_url %}
    <div class="img-card"><img src="{% static 'image-asset/img-1.jpg' %}" alt="image"></div>
    <div class="img-card"><img src="{% static 'image-asset/img-2.jpg' %}" alt="image"></div>
    <div class="img-card"><img src="{% static 'image-asset/img-3.jpg' %}" alt="image"></div>
    <div class="img-card"><img src="{% static 'image-asset/img-4.jpg' %}" alt="image"></div>
    {% endif %}
</section>



    <footer class="footer">
      <div class="container">
          <div class="footer-content">
              <div class="footer-left">
                  <p class="copyright">&copy; 2023 ARR WALLPAPERS.</p>
              </div>
              <div class="footer-right">
                  <a href="#" class="back-to-top">Back to Top</a>
              </div>
          </div>
      </div>
  </footer>
</body>

<script>
    function downloadImage(url, filename) {
        const link = document.createElement('a');
        link.href = url;
        link.download = filename;
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
    }
</script>
<script>
    const updateImageCard = (imgDataArray) => {
        // Hide the loader
        const loader = document.querySelector(".loader");
        loader.style.display = "none";

        imgDataArray.forEach((imgObject, index) => {
            const imgCard = imageGallery.querySelectorAll(".img-card")[index];
            const imgElement = imgCard.querySelector("img");
            const downloadBtn = imgCard.querySelector(".download-btn");

            // Set the image source to the AI-generated image data
            const aiGeneratedImage = `data:image/jpeg;base64,${imgObject.b64_json}`;
            imgElement.src = aiGeneratedImage;

            // When the image is loaded, remove the loading class and set download attributes
            imgElement.onload = () => {
                imgCard.classList.remove("loading");
                downloadBtn.setAttribute("href", aiGeneratedImage);
                downloadBtn.setAttribute("download", `${new Date().getTime()}.jpg`);
            };
        });
    }

    const handleImageGeneration = async (e) => {
        e.preventDefault();
        if (isImageGenerating) return;

        // Get user input and image quantity values
        const userPrompt = e.srcElement[0].value;
        const userImgQuantity = parseInt(e.srcElement[1].value);

        // Disable the generate button, update its text, and set the flag
        generateBtn.setAttribute("disabled", true);
        generateBtn.innerText = "Generating";
        isImageGenerating = true;

        // Display the loader
        const loader = document.querySelector(".loader");
        loader.style.display = "block";

        // Display the default images
        const defaultImageCards = Array.from({ length: userImgQuantity }, (_, index) =>
            `<div class="img-card default-img">
                <img src="{% static 'image-asset/img-${index + 1}.jpg' %}" alt="default image">
            </div>`
        ).join("");

        imageGallery.innerHTML = defaultImageCards;

        try {
            // Simulate the delay for generating AI images (replace this with actual API call)
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Simulate the AI-generated images (replace this with actual API response)
            const mockImageData = Array.from({ length: userImgQuantity }, () => ({
                b64_json: "mock_base64_data" // Replace with actual base64 data
            }));

            updateImageCard(mockImageData);
        } catch (error) {
            alert(error.message);
        } finally {
            generateBtn.removeAttribute("disabled");
            generateBtn.innerText = "Generate";
            isImageGenerating = false;
        }
    }
</script>
</html>